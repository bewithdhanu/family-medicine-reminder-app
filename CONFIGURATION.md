# ‚öôÔ∏è Configuration Guide

## üîê Security First: API Configuration

This app **NEVER hardcodes** API endpoint or API key. All configuration comes from gitignored files.

---

## üìã Quick Setup (2 Minutes)

### Step 1: Copy Configuration Template

```bash
cp local.properties.example local.properties
```

### Step 2: Edit `local.properties`

Open `local.properties` and fill in your values:

```properties
# Android SDK location (auto-generated by Android Studio)
sdk.dir=/Users/YOUR_USERNAME/Library/Android/sdk

# API Configuration (REQUIRED)
API_BASE_URL=https://your-api-domain.com/
API_KEY=your-api-key-here
```

### Step 3: Sync Gradle

In Android Studio:
1. Click "Sync Now" when prompted
2. Or: File ‚Üí Sync Project with Gradle Files

### Step 4: Build & Run

The app will now have access to API_BASE_URL and API_KEY via `BuildConfig`.

---

## üèóÔ∏è How It Works

### 1. Configuration Flow

```
local.properties (gitignored)
        ‚Üì
app/build.gradle.kts (reads file)
        ‚Üì
BuildConfig.API_BASE_URL
BuildConfig.API_KEY
        ‚Üì
ApiConfig.kt (validates & provides)
        ‚Üì
AuthInterceptor (adds to requests)
        ‚Üì
All API calls authenticated ‚úÖ
```

### 2. File Structure

```
medicine-tracker/
‚îú‚îÄ‚îÄ local.properties              # ‚ùå Gitignored (your actual config)
‚îú‚îÄ‚îÄ local.properties.example      # ‚úÖ Template (committed)
‚îî‚îÄ‚îÄ app/
    ‚îú‚îÄ‚îÄ build.gradle.kts          # Reads local.properties
    ‚îî‚îÄ‚îÄ src/main/java/.../
        ‚îî‚îÄ‚îÄ data/remote/
            ‚îú‚îÄ‚îÄ ApiConfig.kt      # Access BuildConfig values
            ‚îú‚îÄ‚îÄ AuthInterceptor.kt # Adds API key to requests
            ‚îî‚îÄ‚îÄ RetrofitClient.kt  # Network setup
```

---

## üîë Accessing Configuration in Code

### ‚úÖ Correct Way (Using ApiConfig)

```kotlin
import in.bewithdhanu.medicinetracker.data.remote.ApiConfig

// Get Base URL
val baseUrl = ApiConfig.BASE_URL

// Get API Key
val apiKey = ApiConfig.API_KEY

// Check if configured
if (ApiConfig.isConfigured()) {
    // Proceed with API calls
}
```

### ‚ùå Wrong Way (Direct BuildConfig - NOT Recommended)

```kotlin
// Don't do this directly - use ApiConfig instead
val url = BuildConfig.API_BASE_URL  // ‚ùå No validation
```

### ‚úÖ The ApiConfig Class (with validation)

```kotlin
object ApiConfig {
    val BASE_URL: String
        get() {
            require(BuildConfig.API_BASE_URL.isNotEmpty()) {
                "API_BASE_URL not configured!"
            }
            return BuildConfig.API_BASE_URL
        }
    
    val API_KEY: String
        get() {
            require(BuildConfig.API_KEY.isNotEmpty()) {
                "API_KEY not configured!"
            }
            return BuildConfig.API_KEY
        }
    
    fun isConfigured(): Boolean {
        return BuildConfig.API_BASE_URL.isNotEmpty() && 
               BuildConfig.API_KEY.isNotEmpty()
    }
}
```

---

## üîí Security Features

### 1. ‚úÖ Never Committed to Git

```gitignore
# .gitignore
local.properties
**/local.properties
```

### 2. ‚úÖ Auto-Added to Requests

```kotlin
class AuthInterceptor : Interceptor {
    override fun intercept(chain: Interceptor.Chain): Response {
        val request = chain.request().newBuilder()
            .addHeader("X-API-Key", ApiConfig.API_KEY)
            .build()
        return chain.proceed(request)
    }
}
```

### 3. ‚úÖ Validation on Access

Throws error if not configured - prevents accidental deployment without config.

---

## üö® Troubleshooting

### Error: "API_BASE_URL not configured!"

**Solution:**
1. Check if `local.properties` exists in project root
2. Verify it contains `API_BASE_URL=...`
3. Sync Gradle: File ‚Üí Sync Project with Gradle Files

### Error: "Unresolved reference: BuildConfig"

**Solution:**
1. Ensure `buildFeatures { buildConfig = true }` in `app/build.gradle.kts`
2. Sync Gradle
3. Clean & Rebuild: Build ‚Üí Clean Project, then Build ‚Üí Rebuild Project

### Error: API calls return 401 Unauthorized

**Solution:**
1. Verify `API_KEY` in `local.properties` matches your backend key
2. Check backend logs to see what key is being received
3. Ensure no extra spaces or quotes around the key

---

## üì± Different Environments

### Development

```properties
# local.properties (development)
API_BASE_URL=http://10.0.2.2:8001/  # Android emulator localhost
API_KEY=your-dev-api-key
```

### Production

```properties
# local.properties (production)
API_BASE_URL=https://your-api-domain.com/
API_KEY=your-api-key-here
```

---

## üîê Additional Security (Optional)

### Store API Key in EncryptedSharedPreferences

For extra security at runtime:

```kotlin
// Store encrypted
val encryptedPrefs = EncryptedSharedPreferences.create(
    context,
    "secure_prefs",
    masterKey,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
)

encryptedPrefs.edit()
    .putString("api_key", ApiConfig.API_KEY)
    .apply()
```

---

## ‚úÖ Configuration Checklist

Before running the app:

- [ ] Copied `local.properties.example` to `local.properties`
- [ ] Set `API_BASE_URL` in `local.properties`
- [ ] Set `API_KEY` in `local.properties`
- [ ] Synced Gradle
- [ ] Verified `local.properties` is in `.gitignore`
- [ ] Built project successfully
- [ ] No hardcoded values in code

---

## üìö Related Documentation

- [Security Guide](backend/SECURITY.md)
- [Backend Setup](BACKEND_SETUP.md)
- [.cursorrules](.cursorrules) - Project rules including "no hardcoding" policy

---

## ‚ö†Ô∏è Important Reminders

1. **NEVER commit `local.properties`** - It contains your API key!
2. **NEVER hardcode API_BASE_URL or API_KEY** - Use ApiConfig only
3. **Always use `local.properties.example` as template** for team members
4. **Rotate API keys regularly** - Update in both backend and `local.properties`
5. **Different keys per environment** - Dev vs Production

---

**‚úÖ Configuration complete! Your app is secure and ready for development.**

